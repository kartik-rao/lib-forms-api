#set($accountId = $context.identity.claims["custom:account"])
#foreach($group in $context.identity.claims.get("cognito:groups"))
    #if($group == "Admin")
        #set($isAdmin = true)
    #end
#end
// If is Admin or record owner or belongs to same account
#if($isAdmin || $context.result.owner == $context.identity.sub || $util.parseJson($context.result.data).accountId == $accountId)
{
    $utils.toJson($context.result)
}
#else
    $utils.unauthorized()
#end